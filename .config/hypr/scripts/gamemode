#!/usr/bin/env sh

FLAG="$HOME/.cache/hypr_gamemode_active"
WATCHER="$HOME/.config/hypr/scripts/gamemode-watcher.sh"
PIDFILE="/tmp/hypr_gamemode_watcher.pid"

if [ -f "$FLAG" ]; then
    # Currently gaming mode → switch to normal mode
    hyprctl --batch "\
        keyword animations:enabled 1;\
        keyword general:gaps_in 5;\
        keyword general:gaps_out 6;\
        keyword general:border_size 1;\
        keyword decoration:rounding 18"
    rm -f "$FLAG"

    # Stop watcher if running
    if [ -f "$PIDFILE" ]; then
        kill "$(cat "$PIDFILE")" 2>/dev/null
        rm -f "$PIDFILE"
    fi

    echo "Switched to NORMAL mode, watcher stopped."
else
    # Currently normal mode → switch to gaming mode
    hyprctl --batch "\
        keyword animations:enabled 0;\
        keyword decoration:drop_shadow 0;\
        keyword decoration:blur:enabled 0;\
        keyword general:gaps_in 0;\
        keyword general:gaps_out 0;\
        keyword general:border_size 1;\
        keyword decoration:rounding 0"
    touch "$FLAG"

    # Start watcher if not running
    if [ ! -f "$PIDFILE" ] || ! kill -0 "$(cat "$PIDFILE")" 2>/dev/null; then
        nohup sh "$WATCHER" >/dev/null 2>&1 &
    fi

    echo "Switched to GAMING mode, watcher started."
fi
